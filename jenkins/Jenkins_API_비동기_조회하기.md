# ì œëª¨ì˜¥ì€ ì  í‚¨ìŠ¤ ì¡°íšŒ ë¡œì§ ê°œì„ ìœ¼ë¡œ í•˜ê² ìŠµë‹ˆë‹¤. ê·¼ë° ì´ì œ ë¹„ë™ê¸°ë¥¼ ê³ë“¤ì¸

> ì œëª©ì˜ ë°ˆì€ [ì¡°ë¦¼ìš”ì •ì˜ íœ´ë¨¼ê°•ë¡ì²´](https://www.youtube.com/watch?v=IuBfmQs9wcA#t=65)ì…ë‹ˆë‹¤.

## Intro

í‰í™”ë¡œìš´ 2020ë…„ 9ì›”ì˜ ì–´ëŠ ë‚ ...  

ë°ì¼ë¦¬ ë¯¸íŒ…ì„ ë§ˆì¹˜ê³  ì¼ê°ì„ ì •ë¦¬í•˜ë˜ ì €ì—ê²Œ í•œ ê°€ì§€ ìš”ì²­ì´ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤.  

"ìš°ë¹ˆë‹˜ ì—¬ê¸° ë¡œì§ì´ ì˜¤ë˜ ê±¸ë¦¬ë©´ 90ì´ˆ ë„˜ê²Œ ê±¸ë¦¬ê³  ìˆëŠ”ë° í•œë²ˆ ê°œì„ í•  ìˆ˜ ìˆì„ì§€ í™•ì¸ ë¶€íƒë“œë ¤ìš”."  

'ì­ ì•„ë‹ˆ ëŒ€ì²´ ì–´ë–¤ ë ˆê±°ì‹œê¸¸ë˜ 90ì´ˆì”©ì´ë‚˜ ê±¸ë¦¬ëŠ”ê±°ì•¼'  

ë¼ê³  ìƒê°í•˜ë©° ì½”ë“œë¥¼ ì—´ì–´ì„œ í™•ì¸í–ˆëŠ”ë°ìš”.  

[ì‚¬ì§„]  

ë²”ì¸ì€ ë‹¤ì„¯ ë‹¬ ì „ì˜ ì €ì˜€ìŠµë‹ˆë‹¤.  

ê°œë°œìë“¤ì—ê²ŒëŠ” í”íˆ ìˆëŠ” ì¼ì´ë¼ê³  í•˜ëŠ”ë°... ì €ë§Œ ê²ªê³  ìˆëŠ” ê±´ ì•„ë‹ˆì£ ?  

ì˜¤ëŠ˜ í¬ìŠ¤íŒ…ì—ì„œëŠ” ìœ„ ë ˆê±°ì‹œë¥¼ ìƒì‚°í•˜ê²Œ ëœ ë°°ê²½ê³¼, ê·¸ í•´ê²°ê³¼ì •ì„ ì •ë¦¬í•´ì„œ ê³µìœ í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.  

í¬ê²Œ ì–´ë ¤ìš´ ë‚´ìš©ì€ ì•„ë‹ˆë‹ˆ í•´ê²°í•´ê°€ëŠ” ê³¼ì • ìì²´ì— í¬ì¸íŠ¸ë¥¼ ë‘ê³  ê°€ë³ê²Œ ì½ì–´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤ ğŸ˜‰  

## 5ê°œì›” ì „...

ì…ì‚¬ í›„ [ì‹ ê·œì…ì‚¬ì ì˜¨ë³´ë”© ê³¼ì •](https://woowabros.github.io/experience/2020/03/02/pilot-project-wbluke.html)ì„ ë§ˆë¬´ë¦¬í•˜ê³ , íŒ€ì—ì„œ ê°€ì¥ ë¨¼ì € ë°›ì€ ì²« ë²ˆì§¸ ê³¼ì œëŠ” ì •ì‚°ì‹œìŠ¤í…œ ì–´ë“œë¯¼(ê´€ë¦¬ì í˜ì´ì§€)ì˜ ìµœì´ˆ ì§„ì… í™”ë©´ì¸ `ëŒ€ì‹œë³´ë“œ`ë¥¼ ë§Œë“œëŠ” ê³¼ì œì˜€ìŠµë‹ˆë‹¤.  

ë‹¹ì‹œ ì •ì‚° ì–´ë“œë¯¼ì— ë¡œê·¸ì¸í•œ í›„ ë³´ì´ëŠ” ì²« í™”ë©´ì€ ì¢Œì¸¡ ë©”ë‰´ ë°”ë¥¼ ì œì™¸í•˜ê³ ëŠ” íŠ¹ë³„í•˜ê²Œ ì œê³µë˜ëŠ” ê²ƒì´ ì—†ëŠ” ë¹ˆ í™”ë©´ì´ì—ˆëŠ”ë°ìš”.  

ê´€ë¦¬ì í˜ì´ì§€ë¥¼ ì‚¬ìš©í•˜ì‹œëŠ” ê¸°íš/ìš´ì˜ì ë¶„ì´ ìˆ˜ì‹œë¡œ í™•ì¸í•˜ë©´ ì¢‹ì„ ê°ì¢… ì‹¤ì‹œê°„ ì§€í‘œë“¤ì„ í™”ë©´ì— êµ¬ì¶•í•˜ëŠ” ê²ƒì´ ë°”ë¡œ í•´ë‹¹ ê³¼ì œì˜ ë‚´ìš©ì´ì—ˆìŠµë‹ˆë‹¤.  

### ë°°ì¹˜ ëª¨ë‹ˆí„°ë§

ìš”êµ¬ì‚¬í•­ì— ìˆëŠ” ë§ì€ ì§€í‘œë“¤ ì¤‘ í•˜ë‚˜ëŠ”, ì •ì‚°ì‹œìŠ¤í…œì˜ í—ˆë¦¬ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆëŠ” ìˆ˜ì‹­ ê°œì˜ ë°°ì¹˜ë¥¼ ê°œë°œìê°€ ì•„ë‹Œ ìš´ì˜ì ë¶„ì´ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” `ë°°ì¹˜ ëª¨ë‹ˆí„°ë§` ì§€í‘œì˜€ìŠµë‹ˆë‹¤. 

> ì•„ë˜ì— ì´ì–´ì„œ ë‚˜ì˜¤ëŠ” ë°°ì¹˜ ëª¨ë‹ˆí„°ë§ ë¶„ì„ì— ëŒ€í•œ ë‚´ìš©ì€ ë‹¹ì‹œì— [íƒœí˜„ë‹˜](https://woowabros.github.io/experience/2020/10/08/excel-download.html)ì´ ë§ì€ ë„ì›€ì„ ì£¼ì…¨ìŠµë‹ˆë‹¤ ğŸ™

ë°°ì¹˜ ëª¨ë‹ˆí„°ë§ ì§€í‘œì—ì„œëŠ” ê·¸ë‚  ìˆ˜í–‰ë  ì˜ˆì •ì¸ ë°°ì¹˜ê°€ ì–´ë–¤ ê²ƒì¸ì§€ íŒŒì•…í•  ìˆ˜ ìˆì–´ì•¼ í–ˆê³ , í•´ë‹¹ ë°°ì¹˜ì˜ ì‹¤ì‹œê°„ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ì•¼ í–ˆìŠµë‹ˆë‹¤.  

ë˜í•œ ê° ë°°ì¹˜ì˜ í™œì„±í™”(on/off) ìƒíƒœì™€ ë”ë¶ˆì–´ ìˆ˜í–‰ ì‹œì‘/ì¢…ë£Œ ì‹œê°„ë„ íŠ¸ë˜í‚¹í•  ìˆ˜ ìˆì–´ì•¼ í–ˆìŠµë‹ˆë‹¤.  

ì¦‰, ì •ë¦¬í•˜ìë©´ ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ë“¤ì„ ì–´ë””ì„ ê°€ ì–»ì–´ì˜¤ê±°ë‚˜ í•„ìš”ì— ë”°ë¼ ìƒˆë¡­ê²Œ ì •ì˜í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.  

- ë°°ì¹˜ì˜ ê°€ì¥ ìµœê·¼ ì‘ì—… ìƒíƒœ (ìˆ˜í–‰ì¤‘/ì„±ê³µ/ì‹¤íŒ¨/ìˆ˜í–‰ì˜ˆì •)
- í™œì„±í™” ì—¬ë¶€
- ì‘ì—… ì‹œì‘ì‹œê°„/ì¢…ë£Œì‹œê°„
- ì‘ì—… ì£¼ê¸° (ë°°ì¹˜ê°€ ìˆ˜í–‰ë  ì˜ˆì •ì¸ì§€ë¥¼ íŒë³„í•˜ê¸° ìœ„í•¨)
    - ìš´ì˜ìê°€ ë§¤ì¼/ì˜ì—…ì¼/ë§¤ì›” 1ì¼/ìˆ˜ì‹œ ë“±ìœ¼ë¡œ ì‚¬ì „ì— ì •ì˜í•˜ì—¬ ì§€ì •

ì €í¬ íŒ€ì€ ë°°ì¹˜ ê´€ë¦¬ ë„êµ¬ë¡œ ì  í‚¨ìŠ¤(Jenkins)ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°ìš”.  

[ì‚¬ì§„]  

ì •ì‚°ì‹œìŠ¤í…œì—ì„œ ì´ ì  í‚¨ìŠ¤ë¥¼ í†µí•´ ê´€ë¦¬í•˜ê³  ìˆëŠ” ë°°ì¹˜ì˜ í˜•íƒœë¥¼ íŒŒì•…í•´ë³´ë‹ˆ ë‹¤ìŒê³¼ ê°™ì´ ì„¸ ì¢…ë¥˜ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. (ì´ë¦„ì€ ì„ì˜ë¡œ ë¶™ì—¬ë´¤ìŠµë‹ˆë‹¤)  

[ì‚¬ì§„]  

- Simple Job
    - ê°€ì¥ ë‹¨ìˆœí•œ í˜•íƒœì˜ ë°°ì¹˜ë¡œ, Spring Batchì™€ Jenkins Jobì´ 1:1ì¸ ê²½ìš°
- Trigger Job
    - í•˜ë‚˜ì˜ ì£¼ìš”í•œ ë°°ì¹˜ Aê°€ ìˆê³ , A ë°°ì¹˜ì—ê²Œ ë‹¤ì–‘í•œ íŒŒë¼ë¯¸í„°ë¥¼ ì œê³µí•˜ë©° ìˆ˜í–‰ ìš”ì²­ë§Œ í•˜ê³  ìê¸°ìì‹ ì€ ì¢…ë£Œë˜ëŠ” ë°°ì¹˜
    - ë°°ì¹˜ Aì™€ 1:N ê´€ê³„
    - ì˜ˆë¥¼ ë“¤ì–´, ë°°ì¹˜ Aì— 1ë²ˆ íŒŒë¼ë¯¸í„°ë¥¼ ì œê³µí•˜ëŠ” ë°°ì¹˜, ë°°ì¹˜ Aì— 2ë²ˆ íŒŒë¼ë¯¸í„°ë¥¼ ì œê³µí•˜ëŠ” ë°°ì¹˜ ë“±
- Pipeline Job
    - ì—¬ëŸ¬ ê°œì˜ ë°°ì¹˜ Jobì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” íŒŒì´í”„ë¼ì¸ ë°°ì¹˜
    - íŒŒì´í”„ë¼ì¸ Scriptë¡œ í•˜ìœ„ ë°°ì¹˜ Jobë¥¼ ë‹¨ê³„ë³„ë¡œ ì§€ì •í•´ì„œ ì‹¤í–‰

ì´ë ‡ê²Œ êµ¬í•´ì•¼ í•˜ëŠ” ë°°ì¹˜ì˜ ì •ë³´ì™€, í˜„ì¬ ë°°ì¹˜ ì‹œìŠ¤í…œì˜ ìƒí™©ì„ íŒŒì•…í•˜ê³  ë‚˜ë‹ˆ ë‹¤ìŒê³¼ ê°™ì€ ê³ ë¯¼ì´ ìˆì—ˆìŠµë‹ˆë‹¤.  

**ğŸ’¡ ìˆ˜ì‹­ ê°œì˜ ë°°ì¹˜ê°€ ìˆ˜í–‰ëœ ìƒíƒœë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì–´ë–¤ ë°©ë²•ì„ ì„ íƒí•´ì•¼ í•˜ëŠ”ê°€?**  

í¬ê²ŒëŠ” ë‘ ê°€ì§€ ë°©ë²•ì„ ë†“ê³  ê³ ë¯¼í–ˆëŠ”ë°ìš”.  

ë°”ë¡œ `Spring Batch Metadata Tables`ì™€ `ì  í‚¨ìŠ¤ API` ì˜€ìŠµë‹ˆë‹¤.  

### Spring Batch Metadata Tables

[ì‚¬ì§„]  

[Spring Batch Metadata Tables(Schema)](https://docs.spring.io/spring-batch/docs/current/reference/html/schema-appendix.html)ëŠ” Spring Batchë¡œ ìˆ˜í–‰ëœ ëª¨ë“  Jobì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” ë©”íƒ€ë°ì´í„° í…Œì´ë¸”ì…ë‹ˆë‹¤.  

ìœ„ ìš”êµ¬ì‚¬í•­ê³¼ ê´€ë ¨í•œ ì •ë³´ë“¤ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œëŠ”, ê·¸ì¤‘ì—ì„œë„ BATCH_JOB_INSTANCE í…Œì´ë¸”ê³¼ BATCH_JOB_EXECUTION í…Œì´ë¸”, ê·¸ë¦¬ê³  BATCH_JOB_EXECUTION_PARAMS í…Œì´ë¸”ì„ ì°¸ê³ í•´ì•¼ í•  ê²ƒìœ¼ë¡œ ë³´ì˜€ìŠµë‹ˆë‹¤.  

Spring Batchë¥¼ ì‚¬ìš©í•˜ì‹œëŠ” ë¶„ë“¤ì€ ëŒ€ë¶€ë¶„ ì•„ì‹œê² ì§€ë§Œ, í•œë²ˆ ê°„ë‹¨í•˜ê²Œ ì •ë¦¬í•´ë³´ìë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  

- BATCH_JOB_INSTANCE
    - Job Parameterì— ë”°ë¥¸ ë°°ì¹˜ ìˆ˜í–‰ ì •ë³´ë¥¼ ê¸°ë¡
    - ë™ì¼ íŒŒë¼ë¯¸í„°ë¡œëŠ” ë°ì´í„°ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ (ë°°ì¹˜ ìˆ˜í–‰ ë¶ˆê°€)
- BATCH_JOB_EXECUTION
    - BATCH_JOB_INSTANCEì˜ ìì‹ í…Œì´ë¸”ë¡œ, ëª¨ë“  ì„±ê³µ/ì‹¤íŒ¨ ë‚´ì—­ì„ ê°€ì§€ê³  ìˆìŒ
- BATCH_JOB_EXECUTION_PARAMS
    - ì‹¤ì œ ìˆ˜í–‰ë˜ì—ˆë˜ ë°°ì¹˜ì˜ êµ¬ì²´ì ì¸ ëª¨ë“  íŒŒë¼ë¯¸í„°ê°€ ê¸°ë¡ë˜ëŠ” í…Œì´ë¸”

ë” ìƒì„¸í•œ ë‚´ìš©ì€ [jojolduë‹˜ì˜ ë¸”ë¡œê·¸](https://jojoldu.tistory.com/326)ë¥¼ ì°¸ê³ í•´ë³´ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.  

Spring Batch Metadata Tablesì™€ ìœ„ ìš”êµ¬ì‚¬í•­ì„ ë§¤ì¹­í•´ë³´ë‹ˆ, ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ë“¤ì´ ë³´ì˜€ìŠµë‹ˆë‹¤.  

- íŒŒì´í”„ë¼ì¸ Jobì˜ ìˆ˜í–‰ ì‹œì‘ì‹œê°„/ì¢…ë£Œì‹œê°„ì„ êµ¬í•˜ëŠ” ê²½ìš°, íŒŒì´í”„ë¼ì¸ í•˜ìœ„ ë°°ì¹˜ë“¤ì˜ ìˆœì„œ ë° ì²« ìˆ˜í–‰ ë°°ì¹˜ì™€ ë§ˆì§€ë§‰ ìˆ˜í–‰ ë°°ì¹˜ ì‹œê°„ì„ ì•Œì•„ì™€ì•¼ í•˜ëŠ”ë°, í•„ìš” ì´ìƒì˜ í…Œì´ë¸” ì¡°ì¸ ë° ì¡°íšŒê°€ ë°œìƒí•˜ê³ , ì¶”ê°€ì ì¸ ê´€ë¦¬ í¬ì¸íŠ¸ê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤.
- Jenkins Jobì˜ í™œì„±í™” ì—¬ë¶€ëŠ” Jenkins APIë¡œë§Œ ì–»ì–´ì˜¬ ìˆ˜ ìˆë‹¤.
    - (ì•„ë˜ ìº¡ì³ ì°¸ì¡°) ë°°ì¹˜ í™œì„±í™” on/off ëŠ” `ë¹Œë“œ ì•ˆí•¨` ì²´í¬ë¡œ ê´€ë¦¬í•˜ê³  ìˆë‹¤.

[ì‚¬ì§„]  

### Jenkins API

ë‹¤ìŒìœ¼ë¡œëŠ” Jenkinsì˜ APIì— ëŒ€í•´ ê³ ë¯¼í–ˆëŠ”ë°ìš”.  

[Jenkins API wiki](https://www.jenkins.io/doc/book/using/remote-access-api/)ê°€ ìˆê¸´ í•˜ì§€ë§Œ, ì–´ë–¤ APIê°€ ìˆëŠ”ì§€ ì •í™•í•˜ê²Œ ì •ë¦¬í•´ì£¼ì§€ëŠ” ì•Šê³  ìˆìŠµë‹ˆë‹¤.  

í•˜ì§€ë§Œ ìš°ë¦¬ì˜ ìš”êµ¬ì‚¬í•­ì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì–´ì˜¤ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒ 2ê°œì˜ APIë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.  

ì²« ë²ˆì§¸ë¡œ Jobì— ëŒ€í•œ ì •ë³´ë¥¼ ë°›ì•„ì˜¤ëŠ” API ì…ë‹ˆë‹¤.  

`${Jenkins_URL}/job/${job_name}/api/json` ìœ¼ë¡œ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (Jenkins job í™”ë©´ì—ì„œ `/api/json` ì„ ë¶™ì—¬ì„œ í™•ì¸í•´ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)  

ì£¼ìš”í•œ í•„ë“œë§Œ ê¸°ìˆ í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ í™˜ê²½ì˜ IP ì •ë³´ëŠ” JENKINS_URLë¡œ í‘œì‹œí–ˆìŠµë‹ˆë‹¤.)  

```json
{
  "description": "",
  "displayName": "test-01",
  "fullDisplayName": "test-01",
  "fullName": "test-01",
  "name": "test-01",
  "url": "http://JENKINS_URL/job/test-01/",
  "buildable": true,
  "builds": [
    {
      "_class": "hudson.model.FreeStyleBuild",
      "number": 3,
      "url": "http://JENKINS_URL/job/test-01/3/"
    },
    {
      "_class": "hudson.model.FreeStyleBuild",
      "number": 2,
      "url": "http://JENKINS_URL/job/test-01/2/"
    },
    {
      "_class": "hudson.model.FreeStyleBuild",
      "number": 1,
      "url": "http://JENKINS_URL/job/test-01/1/"
    }
  ],
  "color": "blue",
  "firstBuild": {
    "_class": "hudson.model.FreeStyleBuild",
    "number": 1,
    "url": "http://JENKINS_URL/job/test-01/1/"
  },
  "inQueue": false,
  "keepDependencies": false,
  "lastBuild": {
    "_class": "hudson.model.FreeStyleBuild",
    "number": 3,
    "url": "http://JENKINS_URL/job/test-01/3/"
  },
  "lastCompletedBuild": {
    "_class": "hudson.model.FreeStyleBuild",
    "number": 3,
    "url": "http://JENKINS_URL/job/test-01/3/"
  },
  "lastFailedBuild": {
    "_class": "hudson.model.FreeStyleBuild",
    "number": 2,
    "url": "http://JENKINS_URL/job/test-01/2/"
  },
  "lastStableBuild": {
    "_class": "hudson.model.FreeStyleBuild",
    "number": 3,
    "url": "http://JENKINS_URL/job/test-01/3/"
  },
  "lastSuccessfulBuild": {
    "_class": "hudson.model.FreeStyleBuild",
    "number": 3,
    "url": "http://JENKINS_URL/job/test-01/3/"
  },
  "lastUnstableBuild": null,
  "lastUnsuccessfulBuild": {
    "_class": "hudson.model.FreeStyleBuild",
    "number": 2,
    "url": "http://JENKINS_URL/job/test-01/2/"
  },
  "nextBuildNumber": 4
}
```

Job APIì—ì„œ ëˆˆì—¬ê²¨ ë³¼ ì •ë³´ë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  

- name
    - Job ì´ë¦„
- buildable
    - í™œì„±í™” ì—¬ë¶€ (`ë¹Œë“œ ì•ˆí•¨` ì²´í¬ ì—¬ë¶€)
- lastBuild, lastCompletedBuild, lastFailedBuild
    - ìµœì‹  ë¹Œë“œ URL, ìµœì‹  ì„±ê³µ ë¹Œë“œ URL, ìµœì‹  ì‹¤íŒ¨ ë¹Œë“œ URL

ë‘ ë²ˆì§¸ë¡œëŠ” Buildì— ëŒ€í•œ ì •ë³´ë¥¼ ë°›ì•„ì˜¤ëŠ” API ì…ë‹ˆë‹¤.  

`${Jenkins_URL}/job/${job_name}/${build_id}/api/json` ìœ¼ë¡œ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ìƒì„¸ Build í™”ë©´ì—ì„œ `/api/json` ì„ ë¶™ì—¬ì„œ í™•ì¸í•´ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)  

ë§ˆì°¬ê°€ì§€ë¡œ ì£¼ìš”í•œ í•„ë“œë§Œ ê¸°ìˆ í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.  

```json
{
  "building": false,
  "displayName": "#3",
  "duration": 34,
  "estimatedDuration": 116,
  "fullDisplayName": "test-01 #3",
  "id": "3",
  "keepLog": false,
  "number": 3,
  "result": "SUCCESS",
  "timestamp": 1616924008157,
  "url": "http://JENKINS_URL/job/test-01/3/"
}
```

Build APIì—ì„œ ëˆˆì—¬ê²¨ ë³¼ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  

- building
    - í˜„ì¬ ìˆ˜í–‰ì¤‘ì¸ì§€ ì—¬ë¶€
- duration
    - ìˆ˜í–‰ëœ ì‹œê°„
- result
    - ë¹Œë“œ ê²°ê³¼
- timestamp
    - ìˆ˜í–‰ ì‹œì‘ ì‹œê°„
    - timestampì— durationì„ ë”í•´ì„œ í™˜ì‚°í•˜ë©´ ìˆ˜í–‰ ì¢…ë£Œ ì‹œê°„ì´ ë©ë‹ˆë‹¤.

(ìœ„ 2ê°œ APIë¥¼ ì œì™¸í•œ ë‹¤ë¥¸ APIê°€ ê¶ê¸ˆí•˜ì‹œë©´ Jenkins API wrapping ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ [Jenkins-rest](https://github.com/cdancy/jenkins-rest)ë¥¼ ì°¸ê³ í•´ë³´ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤!)  

ë§ˆì°¬ê°€ì§€ë¡œ Jenkins APIì™€ ìœ„ ìš”êµ¬ì‚¬í•­ì„ ë§¤ì¹­í•´ë³´ë‹ˆ, ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ë“¤ì´ ë³´ì˜€ìŠµë‹ˆë‹¤.  

- Trigger Jobì€ ë‹¤ë¥¸ ë°°ì¹˜ë¥¼ Triggerë§Œ í•˜ê³  ì¢…ë£Œë˜ê¸° ë•Œë¬¸ì—, ì •í™•í•œ ìˆ˜í–‰ì‹œê°„ ë“±ì„ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ì—†ë‹¤.
- í•˜ë‚˜ì˜ ë°°ì¹˜ ë‹¹ 2ë²ˆì˜ API ì¡°íšŒê°€ í•„ìš”í•˜ë‹¤.

Jenkins APIë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì—ì„œ ê°€ì¥ í° ë¬¸ì œëŠ”, í•˜ë‚˜ì˜ APIë§Œ ê°€ì§€ê³ ëŠ” ìš°ë¦¬ê°€ í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.  

ì¦‰, Job APIì—ì„œëŠ” ì–´ë””ë¡œ ê°€ì•¼ Build ì •ë³´ê°€ ìˆëŠ”ì§€ Build ë²ˆí˜¸ì™€ URLë§Œ ë˜ì ¸ì¤„ ë¿ì´ê³ , ê·¸ë ‡ê²Œ ì°¾ì•„ê°„ Build APIì—ì„œëŠ” ë°˜ëŒ€ë¡œ Jobì— ëŒ€í•œ ìƒì„¸ ì •ë³´(í™œì„±í™” ì—¬ë¶€ ë“±)ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.  

ì´ë ‡ê²Œ ë˜ë©´ í•˜ë‚˜ì˜ ë°°ì¹˜ ë‹¹ Job API í•œë²ˆ, Build API í•œë²ˆ, ì´ 2ë²ˆ APIë¥¼ ì°”ëŸ¬ì•¼ í•˜ê³ , ê²°êµ­ ëª¨ë‹ˆí„°ë§í•˜ë ¤ëŠ” ìˆ˜ì‹­ ê°œì˜ ë°°ì¹˜ì˜ 2ë°° ë§Œí¼ API í˜¸ì¶œì„ í•´ì•¼í•˜ëŠ” ìƒí™©ì´ì—ˆìŠµë‹ˆë‹¤.  

ì•„ë‹ˆ ì§‘ì‚¬ë‹˜... ì¹œì ˆí•˜ê²Œ í•œë²ˆì— ë‹¤ ì•Œë ¤ì£¼ì‹œë©´ ì•ˆë©ë‹ˆê¹Œ...  

[ì‚¬ì§„]  

Spring Batch Metadata Tablesì™€ Jenkins API ì¤‘ ê³ ë¯¼í•˜ë‹¤ê°€, ì–´ì°¨í”¼ í™œì„±í™” ì—¬ë¶€ëŠ” APIë¥¼ í†µí•´ ì–»ì–´ì™€ì•¼ í•˜ê³ , ì •ë³´ë¥¼ ì¡°í•©í•˜ê¸°ì—ë„ API ìª½ì´ ë” ë‚«ë‹¤ê³  ìƒê°í•´ í›„ìë¥¼ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.  

ì¥ë‹¨ì ì— ë”°ë¼ ë‘ ë°©ë²•ì„ ì„ì–´ì„œ ì“°ê¸°ì—ëŠ” ê°œë°œ ê¸°ê°„ì´ë‚˜ ë³µì¡ë„ ì¸¡ë©´ì—ì„œ ì í•©í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨í•˜ì˜€ìŠµë‹ˆë‹¤.  

ì§‘ì‚¬ê°€ ì¼ì„ ëŒ€ì¶©í•˜ë©´ ëª©ë§ˆë¥¸ ì£¼ì¸ì´ ìš°ë¬¼ì„ íŒŒì•¼ì£ . ì—°ì¥ ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤. â›  

### í•´ë³´ì, ì¡°íšŒ!

ì „ì²´ì ì¸ ë°°ì¹˜ ëª¨ë‹ˆí„°ë§í”Œë¡œìš°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  

1. ìš´ì˜ìê°€ ëª¨ë‹ˆí„°ë§í•˜ê³  ì‹¶ì€ ë°°ì¹˜ë¥¼ ì–´ë“œë¯¼ì— Job ì´ë¦„/ê´€ë¦¬ìš© ì´ë¦„/ì‘ì—…ì£¼ê¸°/ì¡°íšŒìœ ë¬´ ì •ë³´ì™€ í•¨ê»˜ ë“±ë¡í•œë‹¤.
2. ë“±ë¡í•  ë•Œ Job ì´ë¦„(batchId)ì„ ê¸°ì¤€ìœ¼ë¡œ Jenkins APIë¥¼ ì°”ëŸ¬ì„œ, ì‹¤ì œ ìš´ì˜ë˜ê³  ìˆëŠ” ë°°ì¹˜ì¸ì§€ í™•ì¸í•œë‹¤.
3. ë°°ì¹˜ê°€ ì¡´ì¬í•œë‹¤ë©´, monitoring_batchë¼ëŠ” ë³„ë„ì˜ ëª¨ë‹ˆí„°ë§ìš© ë°°ì¹˜ ê´€ë¦¬ í…Œì´ë¸”ì— ì €ì¥í•œë‹¤.
4. ì¡°íšŒ ì‹œì—ëŠ” ë“±ë¡í•œ batchIdì™€ ì‘ì—…ì£¼ê¸°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¹ì¼ ì¡°íšŒ ëŒ€ìƒì¸ ë°°ì¹˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ ì¼ê´„ ì¡°íšŒí•œë‹¤.

ë¨¼ì €, í•„ìš”í•œ API ì •ë³´ì— ë§ê²Œ JobInfoì™€ BuildInfoë¥¼ ì •ì˜í–ˆìŠµë‹ˆë‹¤.  

```java
@ToString
@Getter
@NoArgsConstructor
public class JobInfo {

    private String description;
    private String displayName;
    private String name;
    private boolean buildable;
    private String url;

    private List<BuildUrl> builds;

    private BuildUrl firstBuild;
    private BuildUrl lastBuild;
    private BuildUrl lastCompletedBuild;
    private BuildUrl lastFailedBuild;
    private BuildUrl lastStableBuild;
    private BuildUrl lastSuccessfulBuild;
    private BuildUrl lastUnstableBuild;
    private BuildUrl lastUnsuccessfulBuild;

    public boolean isLastBuildEmpty() {
        return lastBuild == null;
    }

    public Long getLastBuildNumber() {
        return isLastBuildEmpty() ? null : lastBuild.getNumber();
    }

}

@ToString
@Getter
@NoArgsConstructor
public class BuildUrl {

    private String url;
    private long number;

}
```

Build ì¡°íšŒ API URLì— Job ì´ë¦„ì´ í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ë„ˆë¬´ ë‹¹ì—°í•´ì„œ ê·¸ëŸ°ì§€ APIì—ì„œ Jobì˜ ì´ë¦„ì„ ì œê³µí•˜ê³  ìˆì§€ ì•Šì•„ì„œ, BuildInfoì—ì„œëŠ” ì¶”í›„ í™œìš©ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ì¡°íšŒ í›„ ì´ë¯¸ ê°€ì§€ê³  ìˆëŠ” Job ì´ë¦„ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.  

```java
@ToString
@Getter
@NoArgsConstructor
public class BuildInfo {

    private String batchId; // í•´ë‹¹ ë¹Œë“œì˜ Job Name. APIì—ì„œ ì œê³µí•˜ê³  ìˆì§€ ì•Šì•„ ìˆ˜ë™ìœ¼ë¡œ update í•œë‹¤.

    private String id;
    private long number;
    private String url;

    private boolean building;
    private String description;
    private String displayName;
    private String result;

    private long timestamp;
    private long duration;

    public void updateBatchId(String batchId) {
        this.batchId = batchId;
    }

    public LocalDateTime getBuildStartTime() {
        return new Timestamp(timestamp).toLocalDateTime();
    }

    public LocalDateTime getBuildEndTime() {
        return new Timestamp(timestamp + duration).toLocalDateTime();
    }

}
```

ì •ì‚°ì‹œìŠ¤í…œì—ì„œëŠ” ì´ë¯¸ Jenkins APIë¥¼ í†µí•´ íŠ¹ì • ë°°ì¹˜ë¥¼ ë‹¨ê±´ ì‹¤í–‰í•˜ëŠ” JenkinsConnectorë¼ëŠ” ëª¨ë“ˆì´ ìˆì—ˆê¸° ë•Œë¬¸ì—, í•´ë‹¹ ëª¨ë“ˆì— ì¡°íšŒ ë¡œì§ì„ ì¶”ê°€í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.  

RestTemplateì„ ì‚¬ìš©í•´ì„œ Jobì˜ ì¡´ì¬ ìœ ë¬´ë¥¼ í™•ì¸í•˜ëŠ” ë©”ì„œë“œì™€ JobInfo, BuildInfoë¥¼ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œë¥¼ ê°ê° ì‘ì„±í–ˆìŠµë‹ˆë‹¤.  

> ì  í‚¨ìŠ¤ APIë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì  í‚¨ìŠ¤ í™˜ê²½ì„¤ì •ì—ì„œ ì‚¬ìš©ìë³„ í† í°ì„ ë°œê¸‰í•˜ê³ , Requestì— `ì‚¬ìš©ìID:í† í°` ì˜ í˜•íƒœë¡œ ì¸ì¦ í—¤ë”ë¥¼ ë³´ë‚´ë©´ ë©ë‹ˆë‹¤.

```java
// JenkinsConnector.java

public boolean existsJob(String batchId) {
    try {
        String requestUrl = createJobUrl(batchId); // Job ì¡°íšŒ API URL

        ResponseEntity<JobInfo> responseEntity = createRestTemplate()
                .exchange(requestUrl, GET, new HttpEntity<>("", createAuthHeaders()), JobInfo.class);

        HttpStatus statusCode = responseEntity.getStatusCode();
        return statusCode.is2xxSuccessful();
    } catch (Exception e) {
        log.error(e.getMessage(), e);
        return false;
    }
}

public JobInfo getJobInfo(String batchId) {
    try {
        log.info("address: {}, batchId: {}", address, batchId);
        String requestUrl = createJobUrl(batchId); // Job ì¡°íšŒ API URL

        return createRestTemplate()
                .exchange(requestUrl, GET, new HttpEntity<>("", createAuthHeaders()), JobInfo.class)
                .getBody();
    } catch (Exception e) {
        throw new JenkinsExecuteException("Job Info Fetching Exception! ", e);
    }
}

public BuildInfo getBuildInfo(String batchId, long buildNumber) {
    try {
        log.info("address: {}, batchId: {}, buildNumber: {}", address, batchId, buildNumber);
        String requestUrl = createBuildUrl(batchId, buildNumber); // Build ì¡°íšŒ API URL

        BuildInfo buildInfo = createRestTemplate()
                .exchange(requestUrl, GET, new HttpEntity<>("", createAuthHeaders()), BuildInfo.class)
                .getBody();
        if (buildInfo != null) {
            buildInfo.updateBatchId(batchId);
        }

        return buildInfo;
    } catch (Exception e) {
        throw new JenkinsExecuteException("Build Info Fetching Exception! ", e);
    }
}

private HttpHeaders createAuthHeaders() {
    String credentials = username + ":" + token;
    String base64Credentials = Base64.getEncoder().encodeToString(credentials.getBytes());
    HttpHeaders httpHeaders = new HttpHeaders() {
    };
    httpHeaders.set("Authorization", "Basic " + base64Credentials);
    return httpHeaders;
}
```

ê·¸ë¦¬ê³  ì„œë¹„ìŠ¤ ë¡œì§ì—ì„œ ì´ JenkinsConnectorë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°ì¹˜ í•˜ë‚˜ ë‹¹ Job ì¡°íšŒ, Build ì¡°íšŒë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.  

```java
// MonitoringBatchService.java

public List<MonitoringBatchResponse> search(MonitoringBatchSearchRequest request) {
    LocalDate workingDate = request.getWorkingDate();
    List<MonitoringBatchResponse> monitoringBatchResponses = monitoringBatchServerRepository.searchByCondition(request);
 
    for (MonitoringBatchResponse monitoringBatchResponse : monitoringBatchResponses) {
        updateBuildInfo(monitoringBatchResponse, workingDate); // DBì—ì„œ ì¡°íšŒí•œ ë°°ì¹˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜ë³µë¬¸ì„ ëŒë©´ì„œ í•˜ë‚˜ì”© Job, Build ì¡°íšŒ
    }
    
    // ...
}
 
private void updateBuildInfo(MonitoringBatchResponse monitoringBatchResponse, LocalDate workingDate) {
    String batchId = monitoringBatchResponse.getBatchId();
 
    try {
        JobInfo jobInfo = jenkinsConnector.getJobInfo(batchId); // Job ì¡°íšŒ
        // ...
 
        BuildUrl lastBuild = jobInfo.getLastBuild(); // ìµœì‹  Build ë²ˆí˜¸ í™•ì¸
        if (lastBuild != null) {
            BuildInfo buildInfo = jenkinsConnector.getBuildInfo(batchId, lastBuild.getNumber()); // Build ì¡°íšŒ
             
            // ... ìƒíƒœ ì—…ë°ì´íŠ¸
        }
    } catch (JenkinsExecuteException e) {
        log.error("Jenkins ì—ì„œ ì¡°íšŒí•  ìˆ˜ ì—†ëŠ” ë°°ì¹˜ Job ì…ë‹ˆë‹¤. batchId={}", batchId);
    }
}
```

ìŒ, ì•„ì£¼ ì¡°íšŒê°€ ì˜ ë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ë°°í¬!  

## ë¹„ë™ê¸°ë¡œ ë¡œì§ ê°œì„ 

[ì‚¬ì§„]  

ë„¤, ì§€ê¸ˆê¹Œì§€ ê³¼ê±° íšŒìƒ ì”¬ì´ì—ˆê³ ìš”.  

ì´ì œ ì„œë¬¸ì—ì„œì˜ ìƒí™©ìœ¼ë¡œ ëŒì•„ê°€ì„œ ì´ ë¬´ì§€ë§‰ì§€í•œ API í˜¸ì¶œì„ ì†ë³¼ ì°¨ë¡€ì…ë‹ˆë‹¤.  

ì‚¬ì‹¤ ë°°ì¹˜ ëª¨ë‹ˆí„°ë§ì€ ëŒ€ì‹œë³´ë“œì˜ ì—¬ëŸ¬ê°€ì§€ ì§€í‘œ ì¤‘ ì§€ë¶„ì´ ì‘ê³  í™œìš©ë„ê°€ ì ì€ ë¶€ë¶„ì´ë¼ ë’¤ëŠ¦ê²Œ ì¸ì§€í•œ ì¸¡ë©´ë„ ìˆì—ˆê³ , ê°œì„  ìš°ì„ ìˆœìœ„ê°€ ë‚®ê¸°ë„ í–ˆì—ˆìŠµë‹ˆë‹¤. ~~í•‘ê³„~~  

í™•ì¸í•œ ë‹¹ì‹œì—ëŠ” ë“±ë¡í•œ ë°°ì¹˜ ìˆ˜ë„ 50ì—¬ ê°œ ê°€ê¹Œì´ ë˜ë©´ì„œ 1íšŒ ì§„ì… ì‹œ í˜¸ì¶œí•˜ëŠ” API íšŸìˆ˜ê°€ 100íšŒì— ê°€ê¹Œì› ìŠµë‹ˆë‹¤.  

API í˜¸ì¶œ 100íšŒë¥¼ ë™ê¸°ì‹ìœ¼ë¡œ ì¡°íšŒí•˜ë‹ˆ ì†ë„ê°€ ì•ˆë‚˜ì˜¤ëŠ”ê±´ ë‹¹ì—°í• ìˆ˜ë°–ì—ìš”.  

ê·¸ë˜ì„œ ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ ìŠ¥ì‚­ ê°œì„ í•´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.  

ë¨¼ì € ê¸°ì¡´ì— ì–´ë“œë¯¼ ì‹œìŠ¤í…œì—ì„œ ë¹„ë™ê¸° ì‘ì—…ì„ ë‹´ë‹¹í•˜ê³  ìˆë˜ ìŠ¤ë ˆë“œ í’€(Executor)ì˜ ì„¤ì •ì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.  

```java
// AsyncConfig.java
 
public static final String ADMIN_DEFAULT_EXECUTOR_NAME = "threadPoolTaskExecutor";
private static final int POOL_SIZE = 30;
 
@Bean(name = ADMIN_DEFAULT_EXECUTOR_NAME)
public Executor threadPoolTaskExecutor() {
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
    executor.setCorePoolSize(POOL_SIZE);
    executor.setMaxPoolSize(POOL_SIZE);
    executor.setThreadNamePrefix("admin-default-async-");
     
    // ...
    return executor;
}
```

## 1ì°¨ ë°°í¬ í›„

## 2ì°¨ ë°°í¬ í›„
